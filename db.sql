BEGIN TRANSACTION;

CREATE TABLE PERSON
(
	ID INTEGER NOT NULL,
    "name" VARCHAR(45) NOT NULL,
    EMAIL VARCHAR(45) NOT NULL,
	SALARY DECIMAL(12,2) NOT NULL,
    BIRTHDAY DATE NOT NULL,
    GENDER CHAR(1) NOT NULL
);

CREATE TABLE "user"
(
	ID INTEGER NOT NULL,
	USERNAME VARCHAR(45) NOT NULL,
	"password" VARCHAR(128) NOT NULL
);

-- KEYS:

ALTER TABLE PERSON ADD CONSTRAINT PK_PERSON PRIMARY KEY (ID); 

ALTER TABLE "user" ADD CONSTRAINT PK_USER PRIMARY KEY (ID); 

-- CONSTRAINTS:

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_NAME_LENGTH CHECK(LENGTH("name") > 3);

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_EMAIL_LENGTH CHECK(LENGTH(EMAIL) > 7);

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_EMAIL_REGEX CHECK(EMAIL ~ '^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$');

ALTER TABLE PERSON ADD CONSTRAINT UNQ_PERSON_EMAIL UNIQUE(EMAIL);

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_SALARY CHECK((SALARY > 0) AND (SALARY < 999999999999.99));

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_BIRTHDAY18 CHECK(BIRTHDAY <= date_trunc('DAY', CURRENT_DATE) - INTERVAL '18YEAR');

ALTER TABLE PERSON ADD CONSTRAINT CHK_PERSON_GENDER CHECK((GENDER = 'M') OR (GENDER = 'F'));

ALTER TABLE "user" ADD CONSTRAINT UNQ_USER_USERNAME UNIQUE(USERNAME);

-- DATAS:

INSERT INTO "user" VALUES (1,'crudadmin','247f2ac3a99de4db240417ba318ad4928cae4f366e44efcb09f0ed41bb9ca34571421fe605cb0e5cc382fa1a4261ae00594d3943d7ab246c178c833844949af6');
INSERT INTO PERSON VALUES(1,'Anthony','anthony@zxcv.com',2000.00,TO_DATE('12/12/1987','MM/DD/YYYY'),'M');
INSERT INTO PERSON VALUES(2,'Alice','alice@zxcv.com',3000.00,TO_DATE('01/15/1985','MM/DD/YYYY'),'F');
INSERT INTO PERSON VALUES(3,'Lucy','lucy@zxcv.com',1500.00,TO_DATE('10/25/1965','MM/DD/YYYY'),'F');
INSERT INTO PERSON VALUES(4,'Paul','paul@zxcv.com',1700.00,TO_DATE('05/01/1994','MM/DD/YYYY'),'M');
INSERT INTO PERSON VALUES(5,'Kate','kate@zxcv.com',2500.00,TO_DATE('01/01/1971','MM/DD/YYYY'),'F');
INSERT INTO PERSON VALUES(6,'Michael','michael@zxcv.com',2700.00,TO_DATE('05/06/1973','MM/DD/YYYY'),'M');
INSERT INTO PERSON VALUES(7,'Suzan','suzan@zxcv.com',1800.00,TO_DATE('02/15/1980','MM/DD/YYYY'),'F');

ROLLBACK;